function post(url,data,callback){var xmlDoc=new XMLHttpRequest;xmlDoc.open("POST",url,!0),xmlDoc.setRequestHeader("Content-type","application/x-www-form-urlencoded"),xmlDoc.onreadystatechange=function(){4===xmlDoc.readyState&&200===xmlDoc.status&&callback(xmlDoc)},xmlDoc.send(serialize(data))}function timeDifference(current,previous){var msPerMinute=6e4,msPerHour=60*msPerMinute,msPerDay=24*msPerHour,msPerMonth=30*msPerDay,msPerYear=365*msPerDay,elapsed=current-previous;return msPerMinute>elapsed?Math.round(elapsed/1e3)+" seconds ago":msPerHour>elapsed?Math.round(elapsed/msPerMinute)+" minutes ago":msPerDay>elapsed?Math.round(elapsed/msPerHour)+" hours ago":msPerMonth>elapsed?"approximately "+Math.round(elapsed/msPerDay)+" days ago":msPerYear>elapsed?"approximately "+Math.round(elapsed/msPerMonth)+" months ago":"approximately "+Math.round(elapsed/msPerYear)+" years ago"}function loadJS(file,callback){var script=document.createElement("script");script.type="application/javascript",script.src=file,loaded=!1,script.onreadystatechange=script.onload=function(){loaded||callback(),loaded=!0},document.body.appendChild(script)}function loadCSS(file){var link=document.createElement("link");link.type="text/css",link.setAttribute("href",file),link.setAttribute("rel","stylesheet"),document.body.appendChild(link)}serialize=function(obj){var str=[];for(var p in obj)obj.hasOwnProperty(p)&&str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]));return str.join("&")},post_root=function(){return document.getElementById("root_comment").classList.remove("is-error"),document.getElementById("root_name").classList.remove("is-error"),0==document.getElementById("root_comment").value.length?void document.getElementById("root_comment").classList.add("is-error"):0==document.getElementById("root_name").value.length?void document.getElementById("root_name").classList.add("is-error"):(data={url:document.location,comment:document.getElementById("root_comment").value,name:document.getElementById("root_name").value,parent:-1},COMMENTO_OPTIONS.honeypot&&(data.gotcha=document.getElementById("root__gotcha").value),void post(COMMENTO_SERVER+"/create",data,function(reply){reply=JSON.parse(reply.response),getcomments()}))},getcomments=function(){data={url:document.location},post(COMMENTO_SERVER+"/get",data,function(reply){reply=JSON.parse(reply.response),comments=reply.comments,redraw()})},submit_reply=function(id){return document.getElementById("reply_textarea_"+id).classList.remove("is-error"),document.getElementById("name_input_"+id).classList.remove("is-error"),0==document.getElementById("reply_textarea_"+id).value.length?void document.getElementById("reply_textarea_"+id).classList.add("is-error"):0==document.getElementById("name_input_"+id).value.length?void document.getElementById("name_input_"+id).classList.add("is-error"):(data={comment:document.getElementById("reply_textarea_"+id).value,name:document.getElementById("name_input_"+id).value,parent:id,url:document.location},COMMENTO_OPTIONS.honeypot&&(data.gotcha=document.getElementById("__gotcha_"+id).value),void post(COMMENTO_SERVER+"/create",data,function(reply){reply=JSON.parse(reply.response),getcomments()}))},cancel_reply=function(id){document.getElementById("reply_textarea_"+id).remove(),document.getElementById("submit_button_"+id).remove(),document.getElementById("cancel_button_"+id).remove(),document.getElementById("name_input_"+id).remove(),document.getElementById("reply_button_"+id).setAttribute("style","display: initial")},show_reply=function(id){var button=document.getElementById("reply_button_"+id);button.setAttribute("style","display: none");var body=document.getElementById("body_"+id),textarea=document.createElement("textarea");textarea.classList.add("form-input"),textarea.id="reply_textarea_"+id,body.appendChild(textarea);var name=document.createElement("input");name.classList.add("form-input"),name.setAttribute("placeholder","Name"),name.setAttribute("style","margin: 1px; width: 33%;"),name.id="name_input_"+id;var cancel=document.createElement("button");cancel.innerHTML="Cancel",cancel.classList.add("btn"),cancel.setAttribute("onclick","cancel_reply("+id+")"),cancel.setAttribute("style","margin: 1px; width: 33%;"),cancel.id="cancel_button_"+id;var submit=document.createElement("button");submit.innerHTML="Reply",submit.classList.add("btn"),submit.classList.add("btn-primary"),submit.setAttribute("onclick","submit_reply("+id+")"),submit.setAttribute("style","margin: 1px; width: 33%;"),submit.id="submit_button_"+id;var button_holder=document.createElement("div");if(button_holder.classList.add("button-holder"),button_holder.setAttribute("style","display: flex; width: 100%; margin: 2px;"),button_holder.appendChild(name),COMMENTO_OPTIONS.honeypot){var honeypot=document.createElement("input");honeypot.classList.add("hidden"),honeypot.id="__gotcha_"+id,button_holder.appendChild(honeypot)}button_holder.appendChild(cancel),button_holder.appendChild(submit),body.appendChild(button_holder)},make_cards=function(coms,cur){if(!(cur in coms)||0==coms[cur].length)return null;for(var cards=document.createElement("div"),i=0;i<coms[cur].length;i++){var card=document.createElement("div");card.classList.add("card");var title=document.createElement("div");title.classList.add("card-header");var h5=document.createElement("h5");h5.innerHTML=coms[cur][i].name;var subtitle=document.createElement("div");subtitle.classList.add("card-subtitle"),subtitle.innerHTML=timeDifference(Date.now(),Date.parse(coms[cur][i].timestamp)),subtitle.setAttribute("style","margin-left: 15px;"),title.appendChild(h5),title.appendChild(subtitle),card.appendChild(title);var body=document.createElement("div");body.id="body_"+coms[cur][i].id,body.classList.add("card-body"),body.innerHTML=converter.makeHtml(coms[cur][i].comment);var res=make_cards(coms,coms[cur][i].id);card.appendChild(body);var footer=document.createElement("div");footer.classList.add("card-header");var button=document.createElement("button");button.id="reply_button_"+coms[cur][i].id,button.classList.add("btn"),button.innerHTML="Reply",button.setAttribute("onclick","show_reply("+coms[cur][i].id+")"),footer.appendChild(button),card.appendChild(footer),null!=res&&(res.classList.add("card-body"),card.appendChild(res)),cards.appendChild(card)}return cards},redraw=function(){document.getElementById("coms").innerHTML="",coms={};for(var i=comments.length-1;i>=0;i--)comments[i].parent in coms||(coms[comments[i].parent]=new Array),coms[comments[i].parent].push(comments[i]);cards=make_cards(coms,-1),null!=cards&&document.getElementById("coms").append(cards)},init_commento=function(server,options){COMMENTO_OPTIONS=options||{honeypot:!1},COMMENTO_SERVER=server,loadJS("https://cdn.rawgit.com/showdownjs/showdown/1.6.3/dist/showdown.min.js",function(){loadCSS("https://cdn.rawgit.com/picturepan2/spectre/master/docs/dist/spectre.min.css"),loadCSS("https://cdn.rawgit.com/adtac/commento/0.0.2/vendor/commento.min.css"),converter=new showdown.Converter;var commento=document.getElementById("commento"),div=document.createElement("div");div.classList.add("commento-comments");var textarea=document.createElement("textarea");textarea.setAttribute("id","root_comment"),textarea.classList.add("form-input");var sub_area=document.createElement("div");sub_area.classList.add("submit_area");var input=document.createElement("input");input.classList.add("form-input"),input.classList.add("root-elem"),input.id="root_name",input.setAttribute("placeholder","Name");var button=document.createElement("button");button.innerHTML="Post comment",button.classList.add("root-elem"),button.classList.add("btn"),button.classList.add("btn-primary"),button.setAttribute("onclick","post_root()");var comselem=document.createElement("div");if(comselem.id="coms",sub_area.appendChild(input),sub_area.appendChild(button),div.appendChild(textarea),options.honeypot){var honeypot=document.createElement("input");honeypot.classList.add("hidden"),honeypot.id="root__gotcha",div.appendChild(honeypot)}div.appendChild(sub_area),div.appendChild(comselem),commento.appendChild(div),getcomments()})};