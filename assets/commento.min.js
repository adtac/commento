function post(e,t,n){var a=new XMLHttpRequest;a.open("POST",e,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){4===a.readyState&&200===a.status&&n(a)},a.send(serialize(t))}function timeDifference(e,t){var n=6e4,a=60*n,d=24*a,o=30*d,r=365*d,m=e-t;return n>m?Math.round(m/1e3)+" seconds ago":a>m?Math.round(m/n)+" minutes ago":d>m?Math.round(m/a)+" hours ago":o>m?"approximately "+Math.round(m/d)+" days ago":r>m?"approximately "+Math.round(m/o)+" months ago":"approximately "+Math.round(m/r)+" years ago"}function loadJS(e,t){var n=document.createElement("script");n.type="application/javascript",n.src=e,loaded=!1,n.onreadystatechange=n.onload=function(){loaded||t(),loaded=!0},document.body.appendChild(n)}function loadCSS(e){var t=document.createElement("link");t.type="text/css",t.setAttribute("href",e),t.setAttribute("rel","stylesheet"),document.body.appendChild(t)}serialize=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")},post_root=function(){return document.getElementById("root_comment").classList.remove("is-error"),document.getElementById("root_name").classList.remove("is-error"),0==document.getElementById("root_comment").value.length?void document.getElementById("root_comment").classList.add("is-error"):0==document.getElementById("root_name").value.length?void document.getElementById("root_name").classList.add("is-error"):(data={url:document.location,comment:document.getElementById("root_comment").value,name:document.getElementById("root_name").value,parent:-1},void post(COMMENTO_SERVER+"/create",data,function(e){e=JSON.parse(e.response),getcomments()}))},getcomments=function(){data={url:document.location},post(COMMENTO_SERVER+"/get",data,function(e){e=JSON.parse(e.response),comments=e.comments,redraw()})},submit_reply=function(e){return document.getElementById("reply_textarea_"+e).classList.remove("is-error"),document.getElementById("name_input_"+e).classList.remove("is-error"),0==document.getElementById("reply_textarea_"+e).value.length?void document.getElementById("reply_textarea_"+e).classList.add("is-error"):0==document.getElementById("name_input_"+e).value.length?void document.getElementById("name_input_"+e).classList.add("is-error"):(data={comment:document.getElementById("reply_textarea_"+e).value,name:document.getElementById("name_input_"+e).value,parent:e,url:document.location},void post(COMMENTO_SERVER+"/create",data,function(e){e=JSON.parse(e.response),getcomments()}))},cancel_reply=function(e){document.getElementById("reply_textarea_"+e).remove(),document.getElementById("submit_button_"+e).remove(),document.getElementById("cancel_button_"+e).remove(),document.getElementById("name_input_"+e).remove(),document.getElementById("reply_button_"+e).setAttribute("style","display: initial")},show_reply=function(e){var t=document.getElementById("reply_button_"+e);t.setAttribute("style","display: none");var n=document.getElementById("body_"+e),a=document.createElement("textarea");a.classList.add("form-input"),a.id="reply_textarea_"+e,n.appendChild(a);var d=document.createElement("input");d.classList.add("form-input"),d.setAttribute("placeholder","Name"),d.setAttribute("style","margin: 1px; width: 33%;"),d.id="name_input_"+e;var o=document.createElement("button");o.innerHTML="Cancel",o.classList.add("btn"),o.setAttribute("onclick","cancel_reply("+e+")"),o.setAttribute("style","margin: 1px; width: 33%;"),o.id="cancel_button_"+e;var r=document.createElement("button");r.innerHTML="Reply",r.classList.add("btn"),r.classList.add("btn-primary"),r.setAttribute("onclick","submit_reply("+e+")"),r.setAttribute("style","margin: 1px; width: 33%;"),r.id="submit_button_"+e;var m=document.createElement("div");m.classList.add("button-holder"),m.setAttribute("style","display: flex; width: 100%; margin: 2px;"),m.appendChild(d),m.appendChild(o),m.appendChild(r),n.appendChild(m)},make_cards=function(e,t){if(!(t in e)||0==e[t].length)return null;for(var n=document.createElement("div"),a=0;a<e[t].length;a++){var d=document.createElement("div");d.classList.add("card");var o=document.createElement("div");o.classList.add("card-header");var r=document.createElement("h5");r.innerHTML=e[t][a].name;var m=document.createElement("div");m.classList.add("card-subtitle"),m.innerHTML=timeDifference(Date.now(),Date.parse(e[t][a].timestamp)),m.setAttribute("style","margin-left: 15px;"),o.appendChild(r),o.appendChild(m),d.appendChild(o);var s=document.createElement("div");s.id="body_"+e[t][a].id,s.classList.add("card-body"),s.innerHTML=converter.makeHtml(e[t][a].comment);var c=make_cards(e,e[t][a].id);d.appendChild(s);var i=document.createElement("div");i.classList.add("card-header");var l=document.createElement("button");l.id="reply_button_"+e[t][a].id,l.classList.add("btn"),l.innerHTML="Reply",l.setAttribute("onclick","show_reply("+e[t][a].id+")"),i.appendChild(l),d.appendChild(i),null!=c&&(c.classList.add("card-body"),d.appendChild(c)),n.appendChild(d)}return n},redraw=function(){document.getElementById("coms").innerHTML="",coms={};for(var e=comments.length-1;e>=0;e--)comments[e].parent in coms||(coms[comments[e].parent]=new Array),coms[comments[e].parent].push(comments[e]);cards=make_cards(coms,-1),null!=cards&&document.getElementById("coms").append(cards)},init_commento=function(e){COMMENTO_SERVER=e,loadJS("https://cdn.rawgit.com/showdownjs/showdown/1.6.3/dist/showdown.min.js",function(){loadCSS("https://cdn.rawgit.com/picturepan2/spectre/master/docs/dist/spectre.min.css"),loadCSS(e+"/assets/commento.min.css"),converter=new showdown.Converter;var t=document.getElementById("commento"),n=document.createElement("div");n.classList.add("commento-comments");var a=document.createElement("textarea");a.setAttribute("id","root_comment"),a.classList.add("form-input");var d=document.createElement("div");d.classList.add("submit_area");var o=document.createElement("input");o.classList.add("form-input"),o.classList.add("root-elem"),o.id="root_name",o.setAttribute("placeholder","Name");var r=document.createElement("button");r.innerHTML="Post comment",r.classList.add("root-elem"),r.classList.add("btn"),r.classList.add("btn-primary"),r.setAttribute("onclick","post_root()");var m=document.createElement("div");m.id="coms",d.appendChild(o),d.appendChild(r),n.appendChild(a),n.appendChild(d),n.appendChild(m),t.appendChild(n),getcomments()})};